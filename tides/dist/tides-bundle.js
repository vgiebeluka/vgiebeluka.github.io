var TidalSimulationLibrary;TidalSimulationLibrary=(()=>{"use strict";var t={535:(t,s,i)=>{i.r(s),i.d(s,{createTidalSimulation:()=>a,tides:()=>o});class e{constructor(t,s){this.x=t,this.y=s}clone(){return new e(this.x,this.y)}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}lengthSqr(){return this.x*this.x+this.y*this.y}add(t){return this.x+=t.x,this.y+=t.y,this}subtract(t){return this.x-=t.x,this.y-=t.y,this}rotate(t){var s=t*Math.PI/180;return this.x=this.x*Math.cos(s)-this.y*Math.sin(s),this.y=this.x*Math.sin(s)+this.y*Math.cos(s),this}orthoNormal(){var t=new e(this.y,this.x);return t.multiplyValue(t.length())}verticalAngle(){return Math.PI-Math.atan2(this.x,this.y)}verticalAngleDeg(){return 180*this.verticalAngle()/Math.PI}addXY(t,s){return this.x+=t,this.y+=s,this}normalize(){var t=this.length();return this.divideValue(t),this}multiplyValue(t){return this.x*=t,this.y*=t,this}divideValue(t){return this.x/=t,this.y/=t,this}rotateEx(t){var s=t*Math.PI/180;return new e(this.x*Math.cos(s)-this.y*Math.sin(s),this.x*Math.sin(s)+this.y*Math.cos(s))}static subtractEx(t,s){return new e(t.x-s.x,t.y-s.y)}static addEx(t,s){return new e(t.x+s.x,t.y+s.y)}}class h{constructor(t){this.distCenterOfMass=0,this.forceMultiplier=0,this.accMultiplier=0,this.ts=0,this.scaleSize=0,this.scaleDist=0,this.scaleContext=0,this.dragMoon=!1,this.dragDropImage=new Image,this.continentsImage=new Image,this.moonImage=new Image,this.bckgImage=new Image,this.config=t,this.canvas=document.getElementById(t.cvid),this.ctx=class{static Create(t){var s=t.getContext("2d");return s.drawVector=function(t,s,i,e,h,o,a){var r=t,l=s,n=r+i,c=l+e,u=Math.atan2(c-l,n-r);this.beginPath(),this.moveTo(r,l),this.lineTo(n,c),this.lineTo(n-h*Math.cos(u-Math.PI/6),c-h*Math.sin(u-Math.PI/7)),this.moveTo(n,c),this.lineTo(n-h*Math.cos(u+Math.PI/6),c-h*Math.sin(u+Math.PI/7)),this.lineWidth=null!=o?o:2,this.strokeStyle=null!=a?a:"yellow",this.stroke(),this.closePath()},s.drawArrow=function(t,s,i,e,h,o,a){var r=Math.atan2(e-s,i-t);this.beginPath(),this.moveTo(t,s),this.lineTo(i,e),this.lineTo(i-h*Math.cos(r-Math.PI/6),e-h*Math.sin(r-Math.PI/7)),this.moveTo(i,e),this.lineTo(i-h*Math.cos(r+Math.PI/6),e-h*Math.sin(r+Math.PI/7)),this.lineWidth=null!=o?o:2,this.strokeStyle=null!=a?a:"yellow",this.stroke(),this.closePath()},s.drawCross=function(t,s,i,e,h){this.beginPath(),this.moveTo(t-e,s),this.lineTo(t+e,s),this.moveTo(t,s-e),this.lineTo(t,s+e),this.strokeStyle=h,this.lineWidth=i,this.stroke(),this.closePath()},s.drawCircle=function(t,s,i,e,h,o,a){this.beginPath(),this.arc(t.x,t.y,s,i,e),null!=h&&(this.fillStyle=h,this.fill()),this.lineWidth=null!=a?a:2,this.strokeStyle=o,this.stroke(),this.closePath()},s.drawCenterOfMass=function(t,s){this.fillStyle="white",this.beginPath(),this.arc(t.x,t.y,s,0,Math.PI/2),this.lineTo(t.x,t.y),this.closePath(),this.fill(),this.fillStyle="black",this.beginPath(),this.arc(t.x,t.y,s,Math.PI/2,Math.PI),this.lineTo(t.x,t.y),this.closePath(),this.fill(),this.fillStyle="white",this.beginPath(),this.arc(t.x,t.y,s,Math.PI,1.5*Math.PI),this.lineTo(t.x,t.y),this.closePath(),this.fill(),this.fillStyle="black",this.beginPath(),this.arc(t.x,t.y,s,1.5*Math.PI,2*Math.PI),this.lineTo(t.x,t.y),this.closePath(),this.fill()},s}}.Create(this.canvas),this.w=this.canvas.width,this.h=this.canvas.height,this.lookAt=new e(0,0),this.numArrows=30,this.time=0,this.gamma=667408e-16,this.distMoonEarth=3844e5,this.distEarthSun=149597870700,this.vecEarthSun=new e(0,0),this.vecEarthMoon=new e(0,0),this.vecCenterOfMass=new e(0,0),0==t.setup?(this.forceMultiplier=1500,this.accMultiplier=1200,this.ts=2,this.scaleSize=2e-5,this.scaleDist=this.scaleSize,this.earth={pos:new e(-9e6,0),m:59721986e17,r:6367500,p:31558118.4,tidalForce:[this.numArrows+1],tidalForceSun:[this.numArrows+1]},this.moon={pos:new e(7e6,0),m:7349e19,r:1738e3,p:2360620.8},this.canvas.addEventListener("mousedown",this.onMouseDown.bind(this),!1),this.canvas.addEventListener("mouseup",this.onMouseUp.bind(this),!1),this.canvas.addEventListener("mousemove",this.onMouseMove.bind(this),!1)):1==t.setup&&(this.setScaleForceToModel(t.scaleForceToModel),this.ts=t.timestep,this.scaleDist=65e-8,this.scaleSize=11e-6,this.scaleContext=this.scaleSize,this.earth={pos:new e(0,0),m:59721986e17,r:6367500,p:31558118.4,tidalForce:[this.numArrows+1],tidalForceSun:[this.numArrows+1]},this.moon={pos:new e(0,0),m:7349e19,r:1738e3,p:2360620.8},this.distCenterOfMass=this.distMoonEarth*this.moon.m/(this.moon.m+this.earth.m)),this.sun={pos:new e(0,0),m:1.98855e30,r:696342e3},this.style={colBack:"#112255",colEarth:"rgb(30,130,220)",colEarthDark:"rgba(0, 0, 0, 0.7)",colEarthOutline:"darkGrey",colMoon:"white",colMoonDark:"rgba(0, 0, 0, 0.7)",colMoonOutline:"rgba(0, 0, 0, 0)",colVec1:"rgba(255, 255, 255, 0.4)",colVec2:"rgba(255, 128, 128, 0.4)",colVec3:"#ffffff",colVec4:"rgba(255, 165, 0, 0.8)",colWater:"rgba(30, 130, 220, 0.6)",colOrbit:"rgba(255, 165, 0, 0.5)",colOrigin:"yellow",colCenterOfEarth:"rgba(255, 165, 0,   1)",colSun:"rgba(255, 235, 50, 0.5)"},this.dragDropImage.src=this.config.path+"/images/dragdrop.png",this.continentsImage.src=this.config.path+"/images/continents.png",this.moonImage.src=this.config.path+"/images/moon.png",this.bckgImage.src=this.config.path+"/images/milkyway.jpg",this.init(t)}init(t){t.isRunning?window.setInterval(this.tick.bind(this),30):this.tick()}tick(){this.update(),this.render()}getMousePos(t){let s=this.canvas.getBoundingClientRect();return{x:t.clientX-s.left,y:t.clientY-s.top}}onMouseDown(t){if(0!=this.config.setup)return;let s=this.getMousePos(t),i=new e(0,0);i.x=s.x-this.lookAt.x*this.scaleDist-this.w/2,i.y=s.y-this.lookAt.y*this.scaleDist-this.h/2,i.divideValue(this.scaleDist);let h=e.subtractEx(this.moon.pos,i).length();this.dragMoon=h<this.moon.r}onMouseUp(t){0==this.config.setup&&(this.dragMoon=!1)}onMouseMove(t){if(0!=this.config.setup)return;let s=this.getMousePos(t);if(null==this.dragMoon||!this.dragMoon)return;let i=s.x-this.lookAt.x*this.scaleDist-this.w/2,h=s.y-this.lookAt.y*this.scaleDist-this.h/2;i/=this.scaleDist,h/=this.scaleDist;let o=new e(i,h),a=e.subtractEx(o,this.earth.pos);e.subtractEx(this.earth.pos,o).length()>2*this.earth.r?this.moon.pos=new e(i,h):(this.moon.pos=this.earth.pos.clone(),this.moon.pos.add(a.normalize().multiplyValue(2*this.earth.r)))}setScaleForceToModel(t){this.config.scaleForceToModel=t,t?(this.accMultiplier=17e5,this.forceMultiplier=this.accMultiplier):(this.accMultiplier=17e5,this.forceMultiplier=10*this.accMultiplier)}addBackground(){let t=this.bckgImage,s=this.ctx,i=s.canvas.width,e=s.canvas.height,h=.5,o=.5;h<0&&(h=0),o<0&&(o=0),h>1&&(h=1),o>1&&(o=1);let a,r,l,n,c=t.width,u=t.height,d=Math.min(i/c,e/u),m=c*d,y=u*d,x=1;m<i&&(x=i/m),y<e&&(x=e/y),m*=x,y*=x,l=c/(m/i),n=u/(y/e),a=(c-l)*h,r=(u-n)*o,a<0&&(a=0),r<0&&(r=0),l>c&&(l=c),n>u&&(n=u),s.drawImage(t,a,r,l,n,0,0,i,e)}resizeToCanvas(){this.w=this.canvas.width,this.h=this.canvas.height}mapToScreen(t,s){let i=t.clone();return i.subtract(this.lookAt),null==s&&(s=this.scaleDist),i.multiplyValue(s),i.addXY(this.w/2,this.h/2),i}setPositions(t,s){this.earth.pos.x=-Math.sin(s)*this.distCenterOfMass,this.earth.pos.y=-Math.cos(s)*this.distCenterOfMass,this.moon.pos.x=Math.sin(s)*(this.distMoonEarth-this.distCenterOfMass),this.moon.pos.y=Math.cos(s)*(this.distMoonEarth-this.distCenterOfMass),this.sun.pos.x=this.earth.pos.x+Math.sin(t)*this.distEarthSun,this.sun.pos.y=this.earth.pos.y+Math.cos(t)*this.distEarthSun}move(){if(this.config.autoMove){let t=2*this.time*Math.PI/this.moon.p,s=2*this.time*Math.PI/this.earth.p;this.setPositions(s,t),this.time+=this.ts}this.vecEarthMoon=e.subtractEx(this.moon.pos,this.earth.pos),this.vecEarthSun=e.subtractEx(this.sun.pos,this.earth.pos);let t=this.earth.pos.clone().multiplyValue(this.earth.m),s=this.moon.pos.clone().multiplyValue(this.moon.m);switch(this.vecCenterOfMass=e.addEx(t,s).divideValue(this.earth.m+this.moon.m),this.config.lookAtTarget){case"Earth":this.lookAt=this.earth.pos.clone();break;case"CenterOfMass":default:this.lookAt=new e(0,0)}}update(){this.move();let t=2*Math.PI/this.numArrows;if(null!=this.config.scaleForceToModel&&this.config.scaleForceToModel)s=this.scaleSize,h=(i=this.scaleDist)*i,o=60;else var s=1,i=1,h=1,o=0;let a=this.vecEarthMoon.clone();a.normalize(),a.multiplyValue(this.gamma*this.moon.m/Math.pow(o+this.vecEarthMoon.length()*i,2)),this.earth.tidalForce[0]=a.multiplyValue(h);let r=this.vecEarthSun.clone();r.normalize(),r.multiplyValue(this.gamma*this.sun.m/Math.pow(o+this.vecEarthSun.length()*i,2)),this.earth.tidalForceSun[0]=r.multiplyValue(h);for(let a=1;a<this.numArrows+1;++a){let r=new e(Math.sin(a*t)*this.earth.r*s,Math.cos(a*t)*this.earth.r*s),l=this.vecEarthMoon.clone();l.multiplyValue(i);let n=e.subtractEx(l,r);n.normalize();let c=e.subtractEx(l,r).length()+o;n.multiplyValue(this.gamma*this.moon.m/(c*c)),this.earth.tidalForce[a]=n.multiplyValue(h);let u=this.vecEarthSun.clone();u.multiplyValue(i);let d=e.subtractEx(u,r);d.normalize(),c=e.subtractEx(u,r).length()+o,d.multiplyValue(this.gamma*this.sun.m/(c*c)),this.earth.tidalForceSun[a]=d.multiplyValue(h)}}renderSun(){let t=this.mapToScreen(this.lookAt),s=this.mapToScreen(this.sun.pos,this.scaleDist),i=(this.mapToScreen(this.earth.pos,this.scaleDist),s.clone().subtract(t).normalize()),h=new e(i.y,-i.x).multiplyValue(this.earth.r*this.scaleSize),o=i.multiplyValue(this.earth.r*this.scaleSize*-1);for(let i=0;i<10;++i)this.ctx.drawArrow(s.x,s.y,t.x+i*h.x-o.x,t.y+i*h.y-o.y,10,2,this.style.colSun),i>0&&this.ctx.drawArrow(s.x,s.y,t.x-i*h.x-o.x,t.y-i*h.y-o.y,10,2,this.style.colSun)}renderMoon(){let t=this.moon.pos.clone();t=this.mapToScreen(t,this.scaleDist);let s=this.moon.r*this.scaleSize;if(0==this.config.setup&&this.vecEarthMoon.length()>1e8){let t=this.mapToScreen(this.earth.pos.clone(),this.scaleDist),s=this.vecEarthMoon.normalize().multiplyValue(100);this.ctx.drawVector(t.x+3*s.x,t.y+3*s.y,s.x,s.y,30,2,this.style.colMoon),this.ctx.font="20px Arial",this.ctx.fillStyle="White",this.ctx.fillText("Moon (385000 km)",t.x+3*s.x-40,t.y+3*s.y+40)}else{let i=this.style.colMoonOutline,e=2;if(1!=this.config.setup){let t=Math.round(128+128*Math.sin(.15*this.time));i="rgb("+t+","+t+","+t+")",e=4}if(this.ctx.drawCircle(t,s,0,2*Math.PI,this.style.colMoon,i,e),this.config.enableRotation?(this.ctx.save(),this.ctx.translate(t.x,t.y),this.ctx.rotate(-this.time*Math.PI*2/this.moon.p+Math.PI),this.ctx.drawImage(this.moonImage,-s,-s,2*s,2*s),this.ctx.restore()):this.ctx.drawImage(this.moonImage,t.x-s,t.y-s,2*s,2*s),this.config.showSun){let i=this.vecEarthSun.verticalAngle(),e=i+Math.PI;this.ctx.drawCircle(t,s,i,e,this.style.colMoonDark,this.style.colMoonOutline)}0==this.config.setup&&this.ctx.drawImage(this.dragDropImage,t.x-s,t.y-s,2*s,2*s);let h=this.moon.r*this.scaleSize;this.ctx.font="20px Arial",this.ctx.fillStyle="White",this.ctx.fillText("Moon",t.x-24,t.y+h+25)}}renderEarth(){let t=this.accMultiplier,s=this.forceMultiplier,i=this.mapToScreen(this.earth.pos,this.scaleSize),h=this.earth.r*this.scaleSize;if(this.ctx.drawCircle(i,h,0,2*Math.PI,this.style.colEarth,this.style.colEarthOutline),this.config.enableRotation?(this.ctx.save(),this.ctx.translate(i.x,i.y),this.ctx.rotate(-this.time*Math.PI*2/86400),this.ctx.drawImage(this.continentsImage,-h,-h,2*h,2*h),this.ctx.restore()):this.ctx.drawImage(this.continentsImage,i.x-h,i.y-h,2*h,2*h),this.config.showSun){let t=this.vecEarthSun.verticalAngle(),s=t+Math.PI;this.ctx.drawCircle(i,h,t,s,this.style.colEarthDark,this.style.colEarthOutline)}let o=this.earth.tidalForce[0].clone(),a=this.earth.tidalForceSun[0].clone();if(this.config.showGravAcc||this.config.showCentAcc||this.config.showTidalAcc||this.config.showTidalAccSun||this.config.showAccSum){let h=[this.numArrows+1],r=2*Math.PI/this.numArrows;for(let l=1;l<this.numArrows+1;++l){let n=e.addEx(i,new e(Math.sin(l*r)*this.earth.r*this.scaleSize,Math.cos(l*r)*this.earth.r*this.scaleSize)),c=this.earth.tidalForce[l];this.config.showGravAcc&&this.ctx.drawVector(n.x,n.y,c.x*t,c.y*t,5,2,this.style.colVec1),this.config.showCentAcc&&this.ctx.drawVector(n.x,n.y,-o.x*t,-o.y*t,5,2,this.style.colVec2);let u=e.subtractEx(c,o);this.config.showTidalAcc&&this.ctx.drawVector(n.x,n.y,u.x*s,u.y*s,4,3,this.style.colVec3);let d=e.subtractEx(this.earth.tidalForceSun[l],a);this.config.showTidalAccSun&&this.ctx.drawVector(n.x,n.y,d.x*s,d.y*s,4,3,this.style.colVec4),h[l]={x:n.x+s*(u.x+d.x),y:n.y+s*(u.y+d.y)}}if(this.config.showAccSum){this.ctx.fillStyle=this.style.colWater,this.ctx.beginPath(),this.ctx.moveTo(h[0].x,h[0].y);for(let t=1;t<this.numArrows+1;++t)this.ctx.lineTo(h[t].x,h[t].y);this.ctx.closePath(),this.ctx.fill()}this.config.showGravAcc&&this.ctx.drawVector(i.x,i.y,o.x*t,o.y*t,5,4,this.style.colVec1)}this.config.showCentAcc&&this.ctx.drawVector(i.x,i.y,-o.x*t,-o.y*t,5,4,this.style.colVec2),this.ctx.drawCross(i.x,i.y,2,5,this.style.colCenterOfEarth)}renderSurfacePoints(){let t=this.accMultiplier,s=this.mapToScreen(this.vecCenterOfMass,this.scaleSize),i=this.mapToScreen(this.earth.pos,this.scaleSize),h=new e(0,this.earth.r*this.scaleSize),o=this.earth.tidalForce[0].clone().length()*t,a=new e(0,0);for(let t=0;t<360;t+=120){let r=h.rotateEx(t),l=e.addEx(i,r),n=e.addEx(s,r.clone());this.ctx.drawCircle(n,this.distCenterOfMass*this.scaleSize,0,2*Math.PI,null,this.style.colVec1),this.ctx.drawCircle(l,3,0,2*Math.PI,this.style.colVec1,this.style.colVec1),a=e.subtractEx(l,n),a.normalize(),a.multiplyValue(o),this.ctx.drawVector(l.x,l.y,a.x,a.y,5,2,this.style.colVec1,this.style.colVec1)}let r=this.mapToScreen(this.earth.pos,this.scaleSize);this.ctx.drawVector(r.x,r.y,a.x,a.y,5,2,this.style.colOrbit,"white")}renderOverlays(){let t=this.mapToScreen(this.vecCenterOfMass,this.scaleSize);this.ctx.drawCenterOfMass(t,4),this.config.showSurfacePoints&&this.renderSurfacePoints()}renderUnderlay(){if(this.config.showEarthOrbit||this.config.showMoonOrbit){if(this.config.showEarthOrbit){let t=this.mapToScreen(this.vecCenterOfMass,this.scaleSize);this.ctx.drawCircle(t,this.distCenterOfMass*this.scaleSize,0,2*Math.PI,null,this.style.colOrbit)}if(this.config.showMoonOrbit){let t=this.mapToScreen(this.vecCenterOfMass,this.scaleDist);this.ctx.drawCircle(t,(this.distMoonEarth-this.distCenterOfMass)*this.scaleDist,0,2*Math.PI,null,this.style.colOrbit)}}}render(){this.config.showBackgroundImage?this.addBackground():(this.ctx.fillStyle=this.style.colBack,this.ctx.fillRect(0,0,this.w,this.h)),this.config.showSun&&this.renderSun(),this.renderUnderlay(),this.renderEarth(),this.config.showMoon&&this.renderMoon(),this.renderOverlays()}}var o=null;function a(t){if(null==document.getElementById(t.cvid))throw Error("createTidalSimulation: There is no canvas object with such an id!");return new h(t)}}},s={};function i(e){if(s[e])return s[e].exports;var h=s[e]={exports:{}};return t[e](h,h.exports,i),h.exports}return i.d=(t,s)=>{for(var e in s)i.o(s,e)&&!i.o(t,e)&&Object.defineProperty(t,e,{enumerable:!0,get:s[e]})},i.o=(t,s)=>Object.prototype.hasOwnProperty.call(t,s),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i(535)})();
//# sourceMappingURL=tides-bundle.js.map